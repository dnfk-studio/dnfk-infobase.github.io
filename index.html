<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>暗夜飛鳶工作室 線上資訊庫</title>
  <meta name="description" content="暗夜飛鳶工作室 線上資訊庫 | 公告、規章、企劃、會議文件的靜態知識庫" />
  <link rel="icon" href="img/favicon.svg">
  <!-- Tailwind via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="assets/css/style.css">
</head>
<body class="bg-slate-950 text-slate-100">
  <header class="sticky top-0 z-50 backdrop-blur bg-slate-900/70 border-b border-white/10">
    <div class="max-w-7xl mx-auto px-4 py-3 flex items-center gap-4">
      <img src="img/logo.svg" alt="logo" class="w-8 h-8">
      <div class="flex-1">
        <h1 class="text-xl md:text-2xl font-semibold tracking-wide">暗夜飛鳶工作室 線上資訊庫</h1>
        <p class="text-xs text-slate-300/80">GitHub Pages 靜態架站．以檔案與 JSON 管理版本與權限（無後端）</p>
      </div>
      <a id="githubLink" class="text-xs opacity-80 hover:opacity-100 underline" target="_blank">GitHub</a>
    </div>
  </header>

  <main class="max-w-7xl mx-auto px-4 py-6 grid grid-cols-1 md:grid-cols-12 gap-6">
    <!-- Sidebar filters -->
    <aside class="md:col-span-3 space-y-6">
      <section class="card">
        <h2 class="card-title">搜尋</h2>
        <input id="q" type="search" placeholder="輸入關鍵字、編號、標籤…" class="input w-full" />
        <div class="mt-2 text-xs text-slate-300/80">支援即時篩選與網址分享（深連結）。</div>
      </section>

      <section class="card">
        <h2 class="card-title">分類</h2>
        <div id="categoryList" class="flex flex-col gap-2"></div>
      </section>

      <section class="card">
        <h2 class="card-title">標籤</h2>
        <div id="tagCloud" class="flex flex-wrap gap-2"></div>
      </section>

      <section class="card">
        <h2 class="card-title">排序</h2>
        <select id="sortBy" class="select w-full">
          <option value="recent">最近更新</option>
          <option value="uploaded">上傳時間（新→舊）</option>
          <option value="title">標題（A→Z）</option>
          <option value="id">編號（A→Z）</option>
        </select>
      </section>

      <section class="card">
        <h2 class="card-title">說明</h2>
        <ol class="list-decimal list-inside space-y-1 text-sm text-slate-300/90">
          <li>新增/修改檔案：直接在 GitHub Repo 內新增 PDF 檔與 <code>data/docs.json</code>。</li>
          <li>版本：在同一文件的 <code>versions[]</code> 列出不同檔案與日期。</li>
          <li>線上閱讀：點擊文件後於右側內嵌或新分頁開啟 PDF。</li>
          <li>深連結：每個文件與版本都有可分享網址。</li>
        </ol>
      </section>
    </aside>

    <!-- Content -->
    <section class="md:col-span-9 space-y-4">
      <div class="flex items-center justify-between gap-4">
        <div id="activeFilters" class="flex flex-wrap gap-2"></div>
        <button id="clearFilters" class="btn-secondary hidden">清除篩選</button>
      </div>
      <div id="resultsInfo" class="text-sm text-slate-300/80"></div>
      <div id="cards" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"></div>
    </section>
  </main>

  <!-- Drawer/Modal for document detail -->
  <div id="drawer" class="drawer hidden">
    <div class="drawer-panel">
      <div class="flex items-center justify-between">
        <h3 id="drawerTitle" class="text-lg font-semibold"></h3>
        <button id="drawerClose" class="icon-btn" title="關閉">✕</button>
      </div>
      <div id="meta" class="mt-3 text-sm space-y-1"></div>
      <div class="mt-4">
        <h4 class="text-sm font-semibold opacity-80">版本</h4>
        <div id="versionList" class="mt-2 flex flex-col gap-2"></div>
      </div>
      <div class="mt-4">
        <h4 class="text-sm font-semibold opacity-80">線上閱讀</h4>
        <div id="viewer" class="mt-2 viewer">
          <div class="text-sm text-slate-300/80">請選擇一個版本以載入 PDF 檔。</div>
        </div>
      </div>
    </div>
    <div class="drawer-mask"></div>
  </div>

  <footer class="py-10 text-center text-xs text-slate-400/80">
    <div>© 暗夜飛鳶工作室 | 建置於 GitHub Pages · 最後更新：<span id="lastUpdated"></span></div>
  </footer>

  <script>
    // Optional: set GitHub repo link (自動從 window.location 估測)
    const repoURLGuess = (function(){
      const h = window.location.hostname;
      const p = window.location.pathname.replace(/^\//,'').replace(/\/$/,''); // e.g. user.github.io/repo/
      if(h.endsWith('github.io') && p) return `https://github.com/${h.split('.')[0]}/${p}`;
      return null;
    })();
    if(repoURLGuess) {
      document.getElementById('githubLink').href = repoURLGuess;
      document.getElementById('githubLink').textContent = '在 GitHub 檢視此程式庫';
    } else {
      document.getElementById('githubLink').classList.add('hidden');
    }
  </script>
  <script src="assets/js/app.js"></script>
</body>
</html>
