<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="color-scheme" content="dark light">
  <title>暗夜飛鳶工作室 線上資訊庫</title>
  <meta name="description" content="公告、規章、企劃、會議文件的靜態資訊庫（GitHub Pages 無後端）" />
  <link rel="icon" href="img/favicon.svg" />
  <link rel="preload" href="assets/css/style.css" as="style">
  <link rel="stylesheet" href="assets/css/style.css" />
</head>
<body>
  <header class="topbar" role="banner">
    <button id="menuBtn" class="icon-btn" aria-label="開啟選單" aria-controls="sidebar" aria-expanded="false">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
        <path d="M4 6h16v2H4V6zm0 5h16v2H4v-2zm0 5h16v2H4v-2z"/>
      </svg>
    </button>
    <a href="./" class="brand" aria-label="返回首頁">
      <img src="img/logo.svg" alt="" class="logo"/>
      <div class="brand-text">
        <strong>暗夜飛鳶工作室 線上資訊庫</strong>
        <span>GitHub Pages · 無後端</span>
      </div>
    </a>
    <a id="githubLink" class="ghost-btn" target="_blank" rel="noopener">在 GitHub 檢視</a>
  </header>

  <div class="layout">
    <!-- Sidebar -->
    <aside id="sidebar" class="sidebar" aria-label="篩選面板">
      <section class="panel">
        <h2 class="panel-title">快速搜尋</h2>
        <div class="input-row">
          <input id="q" type="search" class="input" placeholder="輸入關鍵字、編號、標籤…" aria-label="搜尋文件" autocomplete="off" />
          <button id="clearFilters" class="btn ghost" aria-label="清除篩選">清除</button>
        </div>
        <div class="hint"><kbd>/</kbd> 聚焦搜尋 · Enter 套用</div>
      </section>

      <section class="panel">
        <h2 class="panel-title">分類</h2>
        <div id="categoryList" class="chips"></div>
      </section>

      <section class="panel">
        <h2 class="panel-title">標籤</h2>
        <div id="tagCloud" class="chips"></div>
      </section>

      <section class="panel">
        <h2 class="panel-title">排序</h2>
        <select id="sortBy" class="select" aria-label="排序方式">
          <option value="recent">最近更新</option>
          <option value="uploaded">上傳時間（新→舊）</option>
          <option value="title">標題（A→Z）</option>
          <option value="id">編號（A→Z）</option>
        </select>
      </section>

      <section class="panel small">
        <h2 class="panel-title">使用方式</h2>
        <ol>
          <li>新增/修改：在程式庫加入 PDF 與編輯 <code>data/docs.json</code>。</li>
          <li>版本：同一文件的 <code>versions[]</code> 列出各版。</li>
          <li>閱讀：開啟卡片→選版本→右側即時預覽。</li>
          <li>分享：網址會帶上目前篩選或文件版本。</li>
        </ol>
      </section>
    </aside>

    <!-- Main -->
    <main class="content" id="main">
      <section class="toolbar">
        <div id="activeFilters" class="chips"></div>
        <div class="spacer"></div>
        <div id="resultsInfo" class="muted"></div>
      </section>

      <section id="cards" class="cards" aria-live="polite"></section>
    </main>
  </div>

  <!-- Drawer -->
  <div id="drawer" class="drawer" role="dialog" aria-modal="true" aria-labelledby="drawerTitle" hidden>
    <div class="drawer-panel">
      <div class="drawer-header">
        <div class="drawer-title">
          <h3 id="drawerTitle"></h3>
          <div id="meta" class="muted"></div>
        </div>
        <button id="drawerClose" class="icon-btn" aria-label="關閉">
          ✕
        </button>
      </div>

      <div class="drawer-body">
        <h4 class="section-title">版本</h4>
        <div id="versionList" class="vlist"></div>

        <h4 class="section-title">線上閱讀</h4>
        <div id="viewer" class="viewer">
          <div class="muted pad">請選擇一個版本以載入 PDF。</div>
        </div>
      </div>
    </div>
    <div class="drawer-mask" id="drawerMask"></div>
  </div>

  <footer class="footer">
    © 暗夜飛鳶工作室 · <span id="lastUpdated"></span>
  </footer>

  <script>
    // 推測 repo 連結
    const h = location.hostname, p = location.pathname.replace(/^\//,'').replace(/\/$/,''); 
    const gh = h.endsWith('github.io') && p ? `https://github.com/${h.split('.')[0]}/${p}` : null;
    const a = document.getElementById('githubLink');
    if(gh){ a.href = gh; a.textContent = '在 GitHub 檢視'; } else { a.hidden = true; }
  </script>
  <script src="assets/js/app.js"></script>
</body>
</html>
